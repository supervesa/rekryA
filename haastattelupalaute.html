<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palaute työhaastattelustani</title>
    <link rel="stylesheet" href="tyylit.css"> <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
       
        <h1>Palaute työhaastattelustani</h1>

        <p>Kiitos mahdollisuudesta päästä kertomaan itsestäni ja osaamisestani sekä kuulemaan avoinna olevasta paikasta. Vaikka tällä kertaa en tullut valituksi, haastatteluun liittyvä palautteenne olisi minulle erittäin arvokasta. Se auttaisi minua ymmärtämään, miten voisin kehittää esiintymistäni ja vuorovaikutustani haastattelutilanteissa tulevaisuudessa. Kiitos paljon avustanne!</p>

        <form id="interviewFeedbackForm">
            <input type="hidden" id="application_id_fk" name="application_id_fk">
            <input type="hidden" id="job_id_fk" name="job_id_fk">

            <h2>1. Arvio ammattitaidostani ja soveltuvuudestani haastattelussa</h2>
            <p class="section-description">Miten arvioitte osaamiseni ja ammattitaitoni ilmenemistä haastattelun aikana sekä sen vastaavuutta työtehtävän vaatimuksiin?</p>

            <div class="slider-container">
                <label for="q1_ammattitaito_yhteensopivuus">Miten arvioitte ammattitaitoni ilmenemistä ja yhteensopivuutta työtehtävään haastattelussa? (1 = vähäinen, 5 = erinomainen)</label>
                <input type="range" id="q1_ammattitaito_yhteensopivuus" name="q1_ammattitaito_yhteensopivuus" min="1" max="5" step="1" value="3" oninput="this.nextElementSibling.value = this.value">
                <output class="slider-value">3</output>
            </div>
            <div class="slider-container">
                <label for="q4_osaamisen_tasmaaminen">Miten arvioitte haastattelussa esiin tulleen osaamiseni vastaavan konkreettisesti työtehtävän keskeisiin tarpeisiin?</label>
                <input type="range" id="q4_osaamisen_tasmaaminen" name="q4_osaamisen_tasmaaminen" min="1" max="5" step="1" value="3" oninput="this.nextElementSibling.value = this.value">
                <output class="slider-value">3</output>
            </div>
            <div class="slider-container">
                <label for="q6_hakemuksen_todellisuuden_yhteensopivuus">Miten haastattelussa ilmennyt osaamiseni vastasi hakemuksessa kuvattua?</label>
                <input type="range" id="q6_hakemuksen_todellisuuden_yhteensopivuus" name="q6_hakemuksen_todellisuuden_yhteensopivuus" min="1" max="5" step="1" value="3" oninput="this.nextElementSibling.value = this.value">
                <output class="slider-value">3</output>
            </div>

            <h2>2. Arvio esiintymisestäni ja kommunikaatiostani haastattelussa</h2>
            <p class="section-description">Miten haastattelutilanne sujui minun osaltani? Pyydän arviotanne yleisestä esiintymisestäni, vuorovaikutuksestani ja kommunikaatiotaidoistani.</p>

            <div class="chip-group-container">
                <div class="chip-group-legend">Mitkä seuraavista kuvaavat mielestänne parhaiten esiintymistäni haastattelussa? (Voit valita useita)</div>
                <div class="chip-group">
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_rento" name="q2_esiintymisluonne_valinnat" value="Rento"><label class="chip-label" for="esiintyminen_rento">Rento</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_itsevarma" name="q2_esiintymisluonne_valinnat" value="Itsevarma"><label class="chip-label" for="esiintyminen_itsevarma">Itsevarma</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_jannittynyt" name="q2_esiintymisluonne_valinnat" value="Jännittynyt"><label class="chip-label" for="esiintyminen_jannittynyt">Jännittynyt</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_asiallinen" name="q2_esiintymisluonne_valinnat" value="Asiallinen"><label class="chip-label" for="esiintyminen_asiallinen">Asiallinen</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_energinen" name="q2_esiintymisluonne_valinnat" value="Energinen"><label class="chip-label" for="esiintyminen_energinen">Energinen</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_rauhallinen" name="q2_esiintymisluonne_valinnat" value="Rauhallinen"><label class="chip-label" for="esiintyminen_rauhallinen">Rauhallinen</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_puhelias" name="q2_esiintymisluonne_valinnat" value="Puhelias"><label class="chip-label" for="esiintyminen_puhelias">Puhelias</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_hiljainen" name="q2_esiintymisluonne_valinnat" value="Hiljainen"><label class="chip-label" for="esiintyminen_hiljainen">Hiljainen</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_innostunut" name="q2_esiintymisluonne_valinnat" value="Innostunut"><label class="chip-label" for="esiintyminen_innostunut">Innostunut</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_harkitseva" name="q2_esiintymisluonne_valinnat" value="Harkitseva"><label class="chip-label" for="esiintyminen_harkitseva">Harkitseva</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_hermostunut" name="q2_esiintymisluonne_valinnat" value="Hermostunut"><label class="chip-label" for="esiintyminen_hermostunut">Hermostunut</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_avoin" name="q2_esiintymisluonne_valinnat" value="Avoin"><label class="chip-label" for="esiintyminen_avoin">Avoin</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_pidattyvainen" name="q2_esiintymisluonne_valinnat" value="Pidättyväinen"><label class="chip-label" for="esiintyminen_pidattyvainen">Pidättyväinen</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_ystavallinen" name="q2_esiintymisluonne_valinnat" value="Ystävällinen"><label class="chip-label" for="esiintyminen_ystavallinen">Ystävällinen</label>
                    <input type="checkbox" class="chip-checkbox" id="esiintyminen_analyyttinen" name="q2_esiintymisluonne_valinnat" value="Analyyttinen"><label class="chip-label" for="esiintyminen_analyyttinen">Analyyttinen</label>
                </div>
            </div>

            <div class="slider-container">
                <label for="q3_vastausten_selkeys_asiantuntemus">Miten selkeitä ja vakuuttavia vastaukseni olivat haastattelussa?</label>
                <input type="range" id="q3_vastausten_selkeys_asiantuntemus" name="q3_vastausten_selkeys_asiantuntemus" min="1" max="5" step="1" value="3" oninput="this.nextElementSibling.value = this.value">
                <output class="slider-value">3</output>
            </div>
            <div class="slider-container">
                <label for="q5_vahvuuksien_korostaminen_arvio">Miten hyvin sain mielestänne tuotettua vahvuuksiani esille haastattelussa?</label>
                <input type="range" id="q5_vahvuuksien_korostaminen_arvio" name="q5_vahvuuksien_korostaminen_arvio" min="1" max="5" step="1" value="3" oninput="this.nextElementSibling.value = this.value">
                <output class="slider-value">3</output>
            </div>
            <div class="slider-container">
                <label for="q8_reagointi_haastaviin_tilanteisiin_arvio">Miten arvioitte reagointiani mahdollisesti haastaviin kysymyksiin tai tilanteisiin haastattelussa?</label>
                <input type="range" id="q8_reagointi_haastaviin_tilanteisiin_arvio" name="q8_reagointi_haastaviin_tilanteisiin_arvio" min="1" max="5" step="1" value="3" oninput="this.nextElementSibling.value = this.value">
                <output class="slider-value">3</output>
            </div>
            <div class="slider-container">
                <label for="q9_oma_aloitteisuus_arvio">Miten oma-aloitteinen ja aktiivinen olin haastattelussa?</label>
                <input type="range" id="q9_oma_aloitteisuus_arvio" name="q9_oma_aloitteisuus_arvio" min="1" max="5" step="1" value="3" oninput="this.nextElementSibling.value = this.value">
                <output class="slider-value">3</output>
            </div>

            <h2>3. Motivaation, joustavuuden ja kehittymismahdollisuuksien arviointi haastattelussa</h2>
            <p class="section-description">Miten hyvin onnistuin välittämään kiinnostukseni ja potentiaalini haastattelun aikana?</p>

            <div class="slider-container">
                <label for="q7_motivaatio_tehtavaan_yritykseen_arvio">Miten korkeaksi arvioitte motivaationi ja kiinnostukseni työtehtävää ja yritystänne kohtaan haastattelussa?</label>
                <input type="range" id="q7_motivaatio_tehtavaan_yritykseen_arvio" name="q7_motivaatio_tehtavaan_yritykseen_arvio" min="1" max="5" step="1" value="3" oninput="this.nextElementSibling.value = this.value">
                <output class="slider-value">3</output>
            </div>
            <div class="slider-container">
                <label for="q11_adaptiivisuus_muutoksiin_arvio">Miten arvioitte sopeutumiskykyäni ja joustavuuttani haastattelun perusteella?</label>
                <input type="range" id="q11_adaptiivisuus_muutoksiin_arvio" name="q11_adaptiivisuus_muutoksiin_arvio" min="1" max="5" step="1" value="3" oninput="this.nextElementSibling.value = this.value">
                <output class="slider-value">3</output>
            </div>
            <div class="slider-container">
                <label for="q10_kasvupotentiaali_arvio">Miten arvioitte mahdollisuuksiani kehittyä ja kasvaa tässä tai vastaavassa työtehtävässä?</label>
                <input type="range" id="q10_kasvupotentiaali_arvio" name="q10_kasvupotentiaali_arvio" min="1" max="5" step="1" value="3" oninput="this.nextElementSibling.value = this.value">
                <output class="slider-value">3</output>
            </div>

            <h2>4. Vapaamuotoiset huomiot ja kehitysvinkit haastatteluun liittyen</h2>
            <p class="section-description">Tässä kohtaa pyytäisin teitä antamaan vapaamuotoista palautetta haastattelustani sekä erityisesti vinkkejä, miten voisin kehittää esiintymistäni ja viestintääni haastattelutilanteissa tulevaisuutta varten. Kaikki rakentava palaute on tervetullutta!</p>
            <div>
                <label for="lisatietoa_muuta">Vapaamuotoinen palaute ja vinkit haastatteluuni liittyen</label>
                <textarea id="lisatietoa_muuta" name="lisatietoa_muuta" rows="5"></textarea>
            </div>
            <button type="submit" id="submitButton">Lähetä haastattelupalaute</button>
            <div id="form-feedback"></div>
        </form>
         <div class="applicant-name-header">Vesa Nessling</div>
        <div id="application-info"></div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const SUPABASE_URL = 'https://kistxgsnxvfftgshbpax.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtpc3R4Z3NueHZmZnRnc2hicGF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY4MjQxOTcsImV4cCI6MjA2MjQwMDE5N30.OGcxcwVAX8R925Eq7Vr5vWbtHLqPl_OQBF39R_6nTqQ';

            if (typeof supabase === 'undefined' || typeof supabase.createClient !== 'function') {
                console.error('Supabase client (supabase.createClient) ei ole ladattu tai se ei ole funktio.');
                const feedbackDiv = document.getElementById('form-feedback');
                if (feedbackDiv) {
                    feedbackDiv.textContent = 'Virhe alustuksessa. Yritä myöhemmin uudelleen.';
                    feedbackDiv.className = 'error';
                }
                return;
            }

            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            const form = document.getElementById('interviewFeedbackForm');
            const feedbackDiv = document.getElementById('form-feedback');
            const submitButton = document.getElementById('submitButton');
            const applicationInfoDiv = document.getElementById('application-info');
            const appIdHiddenField = document.getElementById('application_id_fk');
            const jobIdHiddenField = document.getElementById('job_id_fk');

            const urlParams = new URLSearchParams(window.location.search);
            const applicationIdFk = urlParams.get('appId');
            const jobIdFk = urlParams.get('jobId');
            const applicantName = urlParams.get('applicantName');
            const jobTitle = urlParams.get('jobTitle');

            if (applicationIdFk) {
                if (appIdHiddenField) {
                    appIdHiddenField.value = applicationIdFk;
                }
                if (applicationInfoDiv) {
                    let infoText = '';
                    if (applicantName && jobTitle) {
                        infoText = `Palaute hakijan "${decodeURIComponent(applicantName)}" haastattelusta työpaikkaan "${decodeURIComponent(jobTitle)}" (Hakemus ID: ${applicationIdFk})`;
                    } else if (jobTitle) {
                        infoText = `Palaute haastattelusta työpaikkaan: ${decodeURIComponent(jobTitle)} (Hakemus ID: ${applicationIdFk})`;
                    } else if (applicantName && applicantName.toLowerCase() !== applicationIdFk.toLowerCase()) {
                        infoText = `Palaute hakijan "${decodeURIComponent(applicantName)}" haastattelusta (Hakemus ID: ${applicationIdFk})`;
                    } else {
                        infoText = `Palaute haastattelusta hakemukselle ID: ${applicationIdFk}`;
                    }
                    applicationInfoDiv.textContent = infoText;
                }
            } else {
                if (feedbackDiv) {
                    feedbackDiv.textContent = 'Virhe: Hakemuksen ID (appId) puuttuu URL-parametreista.';
                    feedbackDiv.className = 'error';
                }
                if (submitButton) {
                    submitButton.disabled = true;
                }
            }

            if (jobIdFk) {
                if (jobIdHiddenField) {
                    jobIdHiddenField.value = jobIdFk;
                }
            }

            document.querySelectorAll('input[type="range"]').forEach(slider => {
                if (slider.nextElementSibling && slider.nextElementSibling.tagName === 'OUTPUT') {
                    slider.nextElementSibling.value = slider.value;
                }
            });

            form.addEventListener('submit', async (event) => {
                event.preventDefault();
                if (submitButton) submitButton.disabled = true;
                if (feedbackDiv) {
                    feedbackDiv.textContent = 'Lähetetään...';
                    feedbackDiv.className = '';
                }

                const formData = new FormData(form);
                const formProps = Object.fromEntries(formData);

                const esiintymisluonneValinnat = [];
                // Kerätään valitut checkboxit oikealla name-attribuutilla
                form.querySelectorAll('input[name="q2_esiintymisluonne_valinnat"]:checked').forEach((checkbox) => {
                    esiintymisluonneValinnat.push(checkbox.value);
                });

                const getIntOrNull = (value) => {
                    if (value === null || value === undefined || String(value).trim() === '') {
                        return null;
                    }
                    const parsed = parseInt(String(value).trim(), 10);
                    return isNaN(parsed) ? null : parsed;
                };
                
                const finalApplicationIdFk = appIdHiddenField ? appIdHiddenField.value : null;
                const finalJobIdFk = jobIdHiddenField ? jobIdHiddenField.value : null;

                // Muodostetaan dataToSubmit-objekti käyttäen Supabase-taulun sarakkeiden nimiä
                const dataToSubmit = {
                    application_id_fk: finalApplicationIdFk || null,
                    job_id_fk: finalJobIdFk || null,
                    q1_ammattitaito_yhteensopivuus: getIntOrNull(formProps.q1_ammattitaito_yhteensopivuus),
                    q4_osaamisen_tasmaaminen: getIntOrNull(formProps.q4_osaamisen_tasmaaminen),
                    q6_hakemuksen_todellisuuden_yhteensopivuus: getIntOrNull(formProps.q6_hakemuksen_todellisuuden_yhteensopivuus),
                    q2_esiintymisluonne_valinnat: esiintymisluonneValinnat.length > 0 ? esiintymisluonneValinnat : null,
                    q3_vastausten_selkeys_asiantuntemus: getIntOrNull(formProps.q3_vastausten_selkeys_asiantuntemus),
                    q5_vahvuuksien_korostaminen_arvio: getIntOrNull(formProps.q5_vahvuuksien_korostaminen_arvio),
                    q8_reagointi_haastaviin_tilanteisiin_arvio: getIntOrNull(formProps.q8_reagointi_haastaviin_tilanteisiin_arvio),
                    q9_oma_aloitteisuus_arvio: getIntOrNull(formProps.q9_oma_aloitteisuus_arvio),
                    q7_motivaatio_tehtavaan_yritykseen_arvio: getIntOrNull(formProps.q7_motivaatio_tehtavaan_yritykseen_arvio),
                    q11_adaptiivisuus_muutoksiin_arvio: getIntOrNull(formProps.q11_adaptiivisuus_muutoksiin_arvio),
                    q10_kasvupotentiaali_arvio: getIntOrNull(formProps.q10_kasvupotentiaali_arvio),
                    lisatietoa_muuta: formProps.lisatietoa_muuta || null
                };

                const { data, error } = await supabaseClient
                    .from('haastattelut') 
                    .insert([dataToSubmit])
                    .select();

                if (error) {
                    console.error('Virhe tallennettaessa Supabaseen:', error);
                    if (feedbackDiv) {
                        feedbackDiv.textContent = `Virhe: ${error.message}`;
                        feedbackDiv.className = 'error';
                    }
                    if (submitButton) submitButton.disabled = false;
                } else {
                    if (feedbackDiv) {
                        feedbackDiv.textContent = 'Haastattelupalaute tallennettu onnistuneesti! Kiitos.';
                        feedbackDiv.className = 'success';
                        form.reset();
                        document.querySelectorAll('input[type="range"]').forEach(slider => {
                           if (slider.nextElementSibling && slider.nextElementSibling.tagName === 'OUTPUT') {
                               slider.nextElementSibling.value = slider.defaultValue || '3';
                           }
                        });
                        if (submitButton) submitButton.disabled = true;
                    }
                }
            });
        });
    </script>
</body>
</html>
